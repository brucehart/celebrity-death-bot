<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Celebrity Death Bot</title>
    <meta name="description" content="Automated updates of notable deaths sourced from Wikipedia. Generally accurate—mistakes can happen." />
    <link rel="preload" as="image" href="/CelebDeathBot-Header.png" />
    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <style>
      :root {
        --bg: #f7f8fb;
        --panel: #ffffff;
        --text: #111418;
        --muted: #657084;
        --accent: #1f6feb;
        --accent-2: #e14c7c;
        --divider: #e6e9ef;
      }
      * { box-sizing: border-box; }
      html, body { margin: 0; padding: 0; background: var(--bg); color: var(--text); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
      a { color: var(--accent); text-decoration: none; }
      a:hover { text-decoration: underline; }
      .container { max-width: 1200px; margin: 0 auto; padding: 16px; }

      header.hero { position: relative; border-bottom: 1px solid var(--divider); background: #e9eef6; height: clamp(120px, 16vw, 260px); display: flex; align-items: center; justify-content: center; }
      .hero img { width: 100%; height: 100%; display: block; object-fit: contain; object-position: center; filter: saturate(0.9) contrast(1.05); }

      .brand-bar { display: flex; align-items: center; gap: 16px; padding: 16px 0 8px; }
      .brand-bar img.logo { width: 64px; height: 64px; border-radius: 50%; box-shadow: 0 2px 10px rgba(0,0,0,0.08); background: transparent; border: 1px solid var(--divider); }
      .brand-bar .titles { display: flex; flex-direction: column; }
      .brand-bar .title { font-size: 1.8rem; font-weight: 800; letter-spacing: 0.2px; }
      .brand-bar .tagline { color: var(--muted); font-size: 0.98rem; }

      .intro { display: block; padding: 24px 0; }
      .card { background: var(--panel); border: 1px solid var(--divider); border-radius: 12px; padding: 16px; box-shadow: 0 4px 14px rgba(0,0,0,0.08); }
      .card h2 { margin: 4px 0 10px; font-size: 1.1rem; }
      .card p { margin: 8px 0; color: var(--muted); line-height: 1.6; }
      .actions { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 8px; }
      .btn { display: inline-flex; align-items: center; gap: 8px; padding: 10px 14px; border-radius: 10px; border: 1px solid var(--divider); background: var(--panel); color: var(--text); font-weight: 600; }
      .btn:hover { background: #f0f4fb; text-decoration: none; }
      .btn.x { border-color: rgba(31,111,235,0.25); }
      .btn.tg { border-color: rgba(0,170,255,0.25); }
      .hint { font-size: 0.9rem; color: var(--muted); }

      .list { margin: 0; padding: 0; list-style: none; }
      .date-sep { position: sticky; top: 0; background: var(--panel); border: 1px solid var(--divider); color: var(--muted); padding: 6px 10px; margin: 12px 0 10px; border-radius: 999px; width: max-content; box-shadow: 0 10px 20px rgba(0,0,0,0.08); }
      .item { border: 1px solid var(--divider); border-radius: 12px; padding: 14px; margin-bottom: 10px; background: var(--panel); }
      .item .time { color: var(--muted); font-size: 0.85rem; margin-top: 6px; }

      .pagination { display: flex; gap: 10px; justify-content: center; margin: 18px 0 10px; }
      .pagination a { padding: 8px 12px; border-radius: 8px; border: 1px solid var(--divider); background: var(--panel); color: var(--text); font-weight: 600; }
      .pagination a[aria-disabled="true"] { opacity: 0.5; pointer-events: none; }

      footer { padding: 24px 0 40px; color: var(--muted); text-align: center; }
      footer a { color: var(--muted); }

      @media (max-width: 860px) {
        .brand .title { font-size: 1.2rem; }
      }
    </style>
  </head>
  <body>
    <header class="hero">
      <img src="/CelebDeathBot-Header.png" alt="Celebrity Death Bot header" />
    </header>

    <main class="container">
      <div class="brand-bar">
        <img class="logo" src="/Celebrity-Death-Bot.png" alt="Celebrity Death Bot logo" />
        <div class="titles">
          <div class="title">Celebrity Death Bot</div>
          <div class="tagline">Notable deaths via Wikipedia — generally accurate, mistakes can happen.</div>
        </div>
      </div>
      <section class="intro">
        <div class="card" id="about">
          <h2>What is this?</h2>
          <p>
            An automated account that posts notable deaths sourced from Wikipedia. It’s generally accurate, but like any automated system, mistakes can happen.
          </p>
          <p>
            The bot checks recent updates and posts concise notices with a link to Wikipedia. It aims to be respectful, factual, and useful for those following notable passings.
          </p>
          <div class="actions" id="links">
            <a class="btn x" id="x-link" href="#" target="_blank" rel="noopener noreferrer">Follow on X</a>
            <a class="btn tg" id="tg-link" href="#" target="_blank" rel="noopener noreferrer">Open Telegram Bot</a>
          </div>
          <p class="hint">Telegram: Use <code>/start</code> to subscribe and <code>/stop</code> to unsubscribe.</p>
        </div>
      </section>

      <section class="card" id="feed">
        <h2>Latest Postings</h2>
        <p class="hint">Below are the 25 most recent notices with day separators. Use “Older” to browse back in time.</p>
        <ul class="list" id="list"></ul>
        <nav class="pagination">
          <a id="newer" href="/" aria-disabled="true">Newer</a>
          <a id="older" href="#" aria-disabled="true">Older</a>
        </nav>
      </section>
    </main>

    <footer>
      <div>&copy; <span id="year"></span> Celebrity Death Bot</div>
      <div class="hint">Sourced from Wikipedia; may contain mistakes.</div>
      <div class="hint"><a href="/privacy">Privacy</a></div>
    </footer>

    <script>
      const qs = new URLSearchParams(location.search);
      const beforeParam = qs.get('before') || '';

      // Load metadata for links
      fetch('/api/meta').then(r => r.json()).then(meta => {
        const x = document.getElementById('x-link');
        const tg = document.getElementById('tg-link');
        if (meta.xProfileUrl) { x.href = meta.xProfileUrl; x.removeAttribute('aria-disabled'); } else { x.href = '#'; }
        if (meta.telegramBotUrl) { tg.href = meta.telegramBotUrl; tg.removeAttribute('aria-disabled'); } else { tg.href = '#'; }
      }).catch(() => {});

      // Render list with date separators
      function render(items) {
        const ul = document.getElementById('list');
        ul.innerHTML = '';
        let lastDate = '';
        for (const it of items) {
          const dt = new Date(it.posted_at.replace(' ', 'T') + 'Z');
          const day = dt.toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' });
          if (day !== lastDate) {
            const sep = document.createElement('div');
            sep.className = 'date-sep';
            sep.textContent = day;
            ul.appendChild(sep);
            lastDate = day;
          }
          const li = document.createElement('li');
          li.className = 'item';
          const content = document.createElement('div');
          content.className = 'content';
          content.innerHTML = it.html;
          const time = document.createElement('div');
          time.className = 'time';
          time.textContent = new Date(it.posted_at.replace(' ', 'T') + 'Z').toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
          li.appendChild(content);
          li.appendChild(time);
          ul.appendChild(li);
        }
      }

      function setPagination(nextBefore) {
        const older = document.getElementById('older');
        const newer = document.getElementById('newer');
        document.getElementById('year').textContent = new Date().getFullYear();

        if (nextBefore) {
          older.href = `/?before=${encodeURIComponent(nextBefore)}`;
          older.removeAttribute('aria-disabled');
        } else {
          older.setAttribute('aria-disabled', 'true');
          older.href = '#';
        }
        if (beforeParam) {
          newer.href = '/';
          newer.removeAttribute('aria-disabled');
        } else {
          newer.setAttribute('aria-disabled', 'true');
          newer.href = '#';
        }
      }

      fetch('/api/posts' + (beforeParam ? `?before=${encodeURIComponent(beforeParam)}` : ''))
        .then(r => r.json())
        .then(data => { render(data.items || []); setPagination(data.nextBefore || null); })
        .catch(() => { setPagination(null); });
    </script>
  </body>
  </html>
